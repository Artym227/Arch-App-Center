# Руководство по автоматическому обновлению AUR

Этот проект настроен для автоматического обновления версии в AUR репозитории на основе версии из GitHub.

## Структура файлов

- `scripts/update-version.sh` - Скрипт для обновления версии в PKGBUILD и .SRCINFO
- `scripts/update-aur.sh` - Полное обновление AUR с коммитом и пушем
- `Makefile` - Удобные команды для управления
- `PKGBUILD` - Модифицирован для автоматического извлечения версии

## Как это работает

### 1. Автоматическое извлечение версии

PKGBUILD содержит функцию `pkgver()`, которая автоматически извлекает версию из `package.json` GitHub репозитория:

```bash
pkgver() {
  cd "$srcdir/Arch-App-Center"
  node -p "require('./package.json').version"
}
```

### 2. Скрипты обновления

#### Обновление только версии
```bash
./scripts/update-version.sh
```
или
```bash
make update-version
```

Этот скрипт:
- Читает версию из `package.json` в GitHub репозитории
- Сравнивает с текущей версией в AUR
- Обновляет `pkgver` в PKGBUILD если версии различаются
- Сбрасывает `pkgrel` в 1
- Генерирует новый `.SRCINFO`

#### Полное обновление AUR
```bash
./scripts/update-aur.sh
```
или
```bash
make update-aur
```

Этот скрипт:
- Запускает обновление версии
- Создает коммит с изменениями
- Предлагает отправить изменения в AUR

## Процесс обновления

### Когда вы обновляете версию в GitHub:

1. **Измените версию в `package.json`**:
   ```json
   {
     "version": "1.1.0"
   }
   ```

2. **Закоммитьте и запушьте изменения в GitHub**:
   ```bash
   git add package.json
   git commit -m "Bump version to 1.1.0"
   git push origin main
   ```

3. **Обновите AUR**:
   ```bash
   make update-aur
   ```

### Автоматическое обновление

После настройки, при каждом обновлении версии в GitHub, вам нужно только:

1. Обновить версию в `package.json`
2. Запустить `make update-aur`
3. Подтвердить пуш в AUR

## Тестирование

Для тестирования сборки пакета:
```bash
make test-build
```

Это проверит, что PKGBUILD корректно собирается с новой версией.

## Преимущества

✅ **Автоматическое извлечение версии** - не нужно вручную обновлять PKGBUILD  
✅ **Синхронизация версий** - GitHub и AUR всегда в синхроне  
✅ **Автоматическая генерация .SRCINFO** - не нужно помнить о ручном обновлении  
✅ **Безопасность** - пуш в AUR требует подтверждения  
✅ **Удобство** - простые команды make  

## Требования

- Node.js (для извлечения версии из package.json)
- makepkg (для генерации .SRCINFO)
- git (для работы с репозиториями)

## Настройка путей

Если пути к репозиториям отличаются, отредактируйте переменные в скриптах:

```bash
GITHUB_REPO="/home/artym/Arch-App-Center"
AUR_REPO="/home/artym/arch-app-center"
``` 